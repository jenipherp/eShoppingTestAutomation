- name: Commit Extent Report to 'reports-updates' branch
  if: always()
  run: |
    git config --global user.email "github-actions[bot]@users.noreply.github.com"
    git config --global user.name "github-actions[bot]"

    REPORT_FILE=reports/extent-report.html
    TEMP_REPORT_FILE="${{ github.workspace }}/reports/extent-report.html"

    # Check if report file exists
    if [ ! -f "$TEMP_REPORT_FILE" ]; then
      echo "Extent report not found, skipping commit."
      exit 0
    fi

    # Delete the untracked report file to prevent checkout conflict
    rm -f "$REPORT_FILE"

    # Fetch and checkout the reports-updates branch (create if needed)
    git fetch origin

    if git ls-remote --exit-code --heads origin reports-updates; then
      git checkout reports-updates
    else
      git checkout -b reports-updates
      git push -u origin reports-updates
    fi

    # Copy the freshly generated report again (from test run)
    cp "$TEMP_REPORT_FILE" "$REPORT_FILE"

    git add "$REPORT_FILE"
    git commit -m "Update Extent Report [skip ci]" || echo "No changes to commit"
    git push origin reports-updates
